<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <title>iD</title>
        <link rel='stylesheet' href='dist/iD.css'/>
        <meta name='viewport' content='initial-scale=1.0 maximum-scale=1.0'/>
        <meta name='apple-mobile-web-app-capable' content='yes'/>
        <meta name='apple-mobile-web-app-status-bar-style' content='black-translucent'/>
        <script src='dist/iD.js'></script>
    </head>
    <body>
        <div id='id-container'></div>
        <script>

        function start(opts) {
            // Switch service.
            iD.services.osm = iD.services.osmRRA;
            id = iD.Context().assetPath('dist/');
            // Set vars.
            id.connection().projectId(opts.projectId).scenarioId(opts.scenarioId);

            id.ui()(document.getElementById('id-container'));
        }

        function notifier (id, element) {
          let events = {};

          let _notifier = {
            on: (type, cb) => {
              if (!events[type]) events[type] = [];
              events[type].push(cb);
              return _notifier;
            },
            send: (type, data = {}) => {
              let msg = Object.assign({}, { id: id, type: type }, data);
              element.postMessage(msg, '*');
              return _notifier;
            }
          };

          window.addEventListener('message', e => {
            if (!e.data.type) return;
            let cbs = events[e.data.type] || [];
            cbs.forEach(cb => cb(e));
          });

          return _notifier;
        }

        if (window === window.parent) {
            // alert('Not inside an iframe. Prompt for ids');
            // projId = parseInt(prompt('Insert project id'), 10);
            // scId = parseInt(prompt('Insert scenario id'), 10);
            start({projectId: 2000, scenarioId: 2000});
        } else {
            notifier('rra-editor', window.parent)
                .send('loaded')
                .on('settings', data => {
                    start({projectId: data.projectId, scenarioId: data.scenarioId});
                });
        }


        </script>
    </body>
</html>
